<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>AidMatch - Smart Helper Auto Assignment</title>

<style>

body
{
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #eef2f3, #dfe9f3);
    margin: 0;
}

.header
{
    background: #2c3e50;
    color: white;
    padding: 20px;
    text-align: center;
}

.container
{
    width: 70%;
    margin: auto;
    margin-top: 30px;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0px 0px 10px rgba(0,0,0,0.2);
}

button
{
    padding: 10px 20px;
    margin: 10px 5px;
    border: none;
    background: #3498db;
    color: white;
    border-radius: 5px;
    cursor: pointer;
}

button:hover
{
    background: #2980b9;
}

select
{
    padding: 8px;
    margin-top: 10px;
}

#result
{
    margin-top: 20px;
    padding: 15px;
    background: #ecf0f1;
    border-radius: 5px;
}

</style>

</head>

<body>

<div class="header">
<h1>AidMatch</h1>
<p>Smart Helper Auto Assignment System</p>
</div>

<div class="container">

<h3>Book a Helper</h3>

<label>Select Service:</label><br>

<select id="service">
<option value="cleaning">Cleaning</option>
<option value="repairing">Repairing</option>
<option value="plumbing">Plumbing</option>
<option value="electrician">Electrician</option>
</select>

<br>

<button onclick="detectLocation()">Detect My Location</button>

<p id="locationStatus">Location not detected</p>

<button onclick="searchHelper()">Search Helper</button>

<button onclick="confirmBooking()">Confirm Booking</button>

<hr>

<button onclick="viewHelpers()">View All Helpers</button>

<div id="result"></div>

</div>

<script>

const BASE_URL = "https://aidmatch.onrender.com";

let userLat = null;
let userLon = null;
let selectedHelper = null;


// Detect GPS
function detectLocation()
{
    navigator.geolocation.getCurrentPosition(position =>
    {
        userLat = position.coords.latitude;
        userLon = position.coords.longitude;

        document.getElementById("locationStatus").innerHTML =
        "Location: " + userLat + ", " + userLon;
    });
}


// Search helper from database
async function searchHelper()
{
    const service = document.getElementById("service").value;

    if(userLat == null)
    {
        alert("Detect location first");
        return;
    }

    const response = await fetch(BASE_URL + "/api/bookings/search-helper",
    {
        method: "POST",
        headers:
        {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(
        {
            serviceType: service,
            userLatitude: userLat,
            userLongitude: userLon
        })
    });

    const data = await response.json();

    if(data.helper)
    {
        selectedHelper = data.helper;

        document.getElementById("result").innerHTML =
        "Best Helper Found:<br><br>" +
        "Name: " + data.helper.name + "<br>" +
        "Rating: " + data.helper.rating + "<br>" +
        "Distance: " + data.distance.toFixed(2) + " km";
    }
    else
    {
        document.getElementById("result").innerHTML =
        "No helper available";
    }
}


// Confirm booking
async function confirmBooking()
{
    if(!selectedHelper)
    {
        alert("Search helper first");
        return;
    }

    const service = document.getElementById("service").value;

    const response = await fetch(BASE_URL + "/api/bookings/create-booking",
    {
        method: "POST",
        headers:
        {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(
        {
            serviceType: service,
            userLatitude: userLat,
            userLongitude: userLon
        })
    });

    const result = await response.json();

    document.getElementById("result").innerHTML =
    "Booking Confirmed<br>Helper Assigned: " + result.helper.name;
}


// View helpers
async function viewHelpers()
{
    const response = await fetch(BASE_URL + "/api/helpers/all");

    const helpers = await response.json();

    let html = "Helpers:<br><br>";

    helpers.forEach(h =>
    {
        html +=
        h.name +
        " | Skills: " + h.skills +
        " | Rating: " + h.rating +
        "<br>";
    });

    document.getElementById("result").innerHTML = html;
}

</script>

</body>
</html>
